# Punch-game

`Punch-game` 是一个基于 HTML5 Canvas 和 JavaScript 实现的空战射击小游戏。玩家需要操控战机击败不断涌出的敌人，并通过收集道具和升级来提升战力，最终挑战 Boss 获取更高积分。所有进度都会存储在浏览器的 localStorage 中，下次打开页面即可继续游玩。随着全新的 Boss-only「Challenge」模式加入，玩家可以体验以单体 Boss 生存为核心的极限挑战。

## 基本操作
- 方向键：移动战机
- **空格键**：在两种场地 Buff 之间切换（真实伤害 / 护盾回复）
- **U 键**：打开或关闭强化面板
- **F 键**：在普通战机与黄金战机之间切换
- **K 键**：打开作弊面板
- **Challenge 按钮**：在主菜单的模式选择界面点击橙色「Challenge」按钮可进入全新的 Boss-only 挑战模式，完成后会在界面右侧记录累计胜利次数。

## 游戏模式 (Game Modes)
- **普通模式（Normal）**：默认模式会刷新三种不同敌机与道具波次。通过击败敌人获取积分及强化资源，同时可以随时切换场地 Buff，提高生存与输出能力。
- **Boss 连续战（Boss Rush）**：
  - 在主菜单中选择蓝色「Boss」按钮即可进入；
  - 只会出现 Boss，普通敌机会被禁用；
  - Boss 初始血量 ×20，子弹速度减半，更易躲避；
  - 攻击间隔随游玩时间每分钟缩短 5%，最低至基础值的 60%；
  - 击败当前 Boss 后 2 秒刷新下一只，三种主题 Boss 随机轮换。
- **挑战模式（Challenge）**：
  - 开局时会随机挑选现有 Boss 之一作为本轮对手；
  - Boss 生命值被提升为标准值的 **100 倍**（`CHALLENGE_BOSS_HP_MULTIPLIER`）；
  - Boss 攻击节奏乘以 **0.75**，整体攻速略降（对应 `CHALLENGE_ATTACK_CADENCE_MULTIPLIER`），但仍保留原有弹幕变化；
  - 当 Boss HP 降至 0 时不会立即结束战斗，而是进入 10 秒的「狂暴弹幕」阶段并获得完全无敌，需要存活整整 10 秒方可取胜；
  - 狂暴阶段的持续时间由 `CHALLENGE_ENRAGE_DURATION` 控制（等价于 10 秒），胜利后 `localStorage.challengeWins` 会递增 1；
  - 整个挑战过程中不会生成普通敌机，也不会触发任何道具波次或强化掉落，纯粹考验走位与火力。

## 游戏玩法
- 击败敌人或 Boss 会掉落道具：**双倍火力**、**攻速提升**、**双倍积分**，以及集三种效果于一体的 **超级组合道具**。
- 每种道具都有持续时间，可在强化面板中用积分提升。
- 得分同时累计为升级所需的货币，Boss 战提供更多积分奖励。
- 切换到第二场地时战机会自动回复护盾，第一场地则根据击杀数提供额外真实伤害。

> 注意：挑战模式（Challenge）不生成普通敌人或任何道具波次，仅保留玩家已有的强化与机体属性。

### 敌机类型
游戏中有三种不同的敌机，各具特色：
- **基础战机** (50%概率)：生命值1，移动速度1.0，击杀获得10分，碰撞伤害10点
- **强化战机** (30%概率)：生命值2，移动速度1.2，击杀获得20分，碰撞伤害15点
- **精英战机** (20%概率)：生命值3，移动速度1.5，**Z字形移动**，击杀获得30分，碰撞伤害20点

精英战机采用独特的Z字形移动模式，每30帧改变水平方向，增加了射击难度，但提供最高的分数奖励。

## 强化系统
- 强化分为两类：
  1. **道具持续时间**：延长各类道具的效果时间。
  2. **战机属性**：提升攻速、护盾上限以及子弹伤害。
- 默认强化上限为 10 级，只有在使用黄金飞机时才可提升至 20 级，并使所有增益效果翻倍。
- 当所有强化达到 20 级时会解锁特殊奖励：护盾格挡提升以及超级组合道具需求降低。

> 提示：挑战模式继承玩家的所有强化与黄金战机加成，但由于没有额外道具波次，相关的道具持续升级只会影响进入挑战前已经激活的效果。

### 黄金飞机
- 可在强化面板花费 5000 积分购买，购买后可随时切换使用。
- 使用黄金飞机时，道具持续时间和战机属性增益都会翻倍，同时强化等级上限提升至 20 级。
- 在挑战模式中同样适用，可与高额 Boss 血量叠加带来更高输出。

### 作弊码
- 在游戏界面按 **K 键** 打开作弊面板，可直接点击使用作弊码。
- `tq123`：立刻获得 10000 积分。
- `tq456`：触发 20 秒的超级组合效果（双倍火力、攻速和积分）。

## 如何开始（How to Start）
1. 打开 `index.html` 或部署在任意静态服务器上，进入主菜单。
2. 在模式选择区域点击橙色「Challenge」按钮，阅读弹出的规则提示后确认开始。
3. 准备好后直接迎战随机出现的 Boss，存活过 10 秒狂暴阶段即可记录一次胜利。

## 运行方式
本项目完全在浏览器端运行，克隆或下载仓库后直接打开 `index.html` 即可游玩，或在本地启动任意静态文件服务器访问。

## 目录结构
- `index.html`：游戏入口页面
- `style.css`：页面与游戏画面样式
- `game.js`：主要游戏逻辑脚本
- `assets/`：图片与音效等资源

## Boss特效系统

挑战模式在 Boss 进入狂暴弹幕阶段时会触发更高频率的粒子、震动与闪白效果，营造紧张的生存体验。以下是整体的 Boss 特效体系：

### 特效功能
- **粒子系统**：支持可配置的粒子效果，包括颜色、大小、速度、生命周期等参数
- **屏幕震动**：根据攻击强度产生动态震动效果，增强打击感
- **屏幕闪白**：重要时刻（如Boss死亡）的视觉冲击效果

### Boss出现特效
- **传送门效果**：Boss出现时产生大量彩色粒子
- **能量爆发**：延迟后产生金色能量爆发特效
- **震撼登场**：强烈的屏幕震动配合渐现动画

### Boss战斗特效
- **能量光环**：三层旋转光环围绕Boss，不同速度和方向旋转，带有脉冲亮度变化
- **攻击充能**：每种攻击前都有独特的充能特效，包括粒子聚集、光圈扩散和粒子环绕
- **受伤反馈**：Boss受伤时产生红色能量波动，多层能量环脉冲跳动
- **护盾破碎**：护盾被打破时的蓝色粒子爆炸效果

### 攻击特效增强
每种Boss攻击都有专属特效：
- **Boss1**：螺旋弹幕（紫色）、追踪弹（青色）、圆形扩散（黄色）
- **Boss2**：扇形散射（橙色）、反弹弹（绿色）、扩张环（蓝色）
- **Boss3**：地狱火雨（橙红色）、恶魔之眼激光（深红色）、炼狱漩涡（火焰色）
- **子弹轨迹**：部分子弹带有动态轨迹效果
- **特殊效果**：追踪弹发光脉冲、反弹弹电光环绕、火球燃烧轨迹、激光发光、漩涡弹旋转

### Boss死亡特效
- **双重爆炸**：金色和橙色粒子的震撼爆炸
- **强烈震动**：持续800ms的屏幕震动
- **闪白冲击**：覆盖全屏的闪白效果

### 性能优化
- **对象池技术**：粒子和子弹使用对象池，减少内存分配
- **智能限制**：自动限制粒子数量，避免性能问题
- **分层渲染**：特效按正确顺序渲染，保证视觉效果
- **条件绘制**：只在需要时渲染特效，提升帧率

## 参数调优（Tuning & Constants）
- `CHALLENGE_BOSS_HP_MULTIPLIER = 100` —— `game.js` 第 408 行定义，设置挑战模式中 Boss 的生命值倍率。
- `CHALLENGE_ATTACK_CADENCE_MULTIPLIER = 0.75` —— `game.js` 第 409 行定义，决定挑战模式下 Boss 攻击节奏的放缓程度。
- `CHALLENGE_ENRAGE_DURATION_SEC = 10` —— 对应 `game.js` 第 410 行的 `CHALLENGE_ENRAGE_DURATION = 10000`（毫秒制），控制狂暴弹幕阶段的持续时间（10 秒）。

## 数据持久化键（Persistence Keys）
- `localStorage.challengeWins`：每次在挑战模式中成功存活 10 秒狂暴阶段即加 1，用于在主菜单显示累计胜场。

## 更新日志

### v1.6.0 (2025-06-19)
- **新增第三种敌机 - 精英战机**：
  - 添加了全新的精英战机类型
  - **基础属性增强**：3点生命值（最高）、1.5移动速度（最快）
  - **独特移动模式**：Z字形移动轨迹，每30帧改变水平方向，增加射击难度
  - **出现概率**：20%稀有度，平衡游戏难度
  - **奖励系统优化**：击杀获得30分（最高），碰撞造成20点伤害
- **敌机生成系统重构**：
  - 基础战机（Fighter1）：50%概率，1生命值，10分奖励，10点碰撞伤害
  - 强化战机（Fighter2）：30%概率，2生命值，20分奖励，15点碰撞伤害  
  - 精英战机（Fighter3）：20%概率，3生命值，30分奖励，20点碰撞伤害
- **移动系统增强**：为精英战机实现边界检测和智能转向系统
- **游戏平衡调整**：通过差异化的生命值、移动模式和奖励创造更丰富的游戏体验

### v1.5.0 (2025-06-18)
- **新增Boss3 - 地狱主题Boss**：
  - 全新的地狱恶魔Boss，具有2.5倍血量和护盾强度
  - 三种独特攻击模式：地狱火雨、恶魔之眼激光、炼狱漩涡
  - 地狱主题特效系统：熔岩光环、火焰粒子、地狱传送门效果
  - Boss3有33%概率在Boss模式和普通模式中出现
- **地狱火雨攻击**：从天而降的火球，接触地面时爆炸，具有燃烧轨迹
- **恶魔之眼激光**：跟踪玩家的激光束，充能预警后持续伤害
- **炼狱漩涡攻击**：旋转能量漩涡，吸引玩家并发射螺旋火焰弹
- **视觉增强**：Boss3专属的地狱主题色彩（橙红、深红、暗红）
- **特殊子弹效果**：火球、激光段、漩涡弹都有独特的视觉表现
- **修复Boss图像加载问题**：优化Boss绘制逻辑，确保所有Boss正常显示

### v1.4.0 (2025-06-14)
- 新增完整的Boss特效系统，包括粒子效果、屏幕震动、能量光环等
- 优化游戏性能，添加粒子数量限制和智能渲染
- 修复Boss受伤时的白框问题，替换为炫酷的红色能量波动
- 增强所有Boss攻击的视觉效果，每种攻击都有独特的充能和发射特效

### v1.3.0 (2025-06-13)
- 新增「Boss 关挑战」纯 Boss 模式：主界面蓝色按钮进入。
- Boss 模式数值：血量 ×20、子弹速度 0.5 倍、初始攻击间隔 ×1.5，且随时间每分钟递减 5%。

## License
本项目使用 MIT 许可，详情见仓库中的 `LICENSE` 文件。
